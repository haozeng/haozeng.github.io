
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Hao's Blog</title>
  <meta name="author" content="Hao Zeng">

  
  <meta name="description" content="Recently, I did an exercise using twitter streaming api to generate the most recent 10
retweets in the past n minutes. The program is pretty simple. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://haozeng.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Hao's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Hao's Blog</a></h1>
  
    <h2>Ruby/Node.js Developer</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:haozeng.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about-me">About Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/08/twitter-streaming-retweets/">Twitter Streaming Retweets</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-08T22:46:49-07:00" pubdate data-updated="true">May 8<span>th</span>, 2014</time>
        
           | <a href="/blog/2014/05/08/twitter-streaming-retweets/#disqus_thread"
             data-disqus-identifier="http://haozeng.github.io/blog/2014/05/08/twitter-streaming-retweets/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently, I did an exercise using twitter streaming api to generate the most recent 10
retweets in the past n minutes.</p>

<p>The program is pretty simple. It sends http streaming requests to twitter api and doing sorting in the background thread, while the main thread is printing out the most recent 10 retweets.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;twitter&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;pry&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;pp&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Streamer</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:client</span><span class="p">,</span> <span class="ss">:background_thread</span><span class="p">,</span> <span class="ss">:mins</span><span class="p">,</span> <span class="ss">:container</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@client</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:client</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@mins</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:mins</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@container</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:container</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">stream</span>
</span><span class='line'>    <span class="vi">@background_thread</span> <span class="o">=</span> <span class="no">Thread</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>
</span><span class='line'>      <span class="vi">@client</span><span class="o">.</span><span class="n">sample</span> <span class="k">do</span> <span class="o">|</span><span class="n">object</span><span class="o">|</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">object</span><span class="o">.</span><span class="n">is_a?</span><span class="p">(</span><span class="ss">Twitter</span><span class="p">:</span><span class="ss">:Tweet</span><span class="p">)</span>
</span><span class='line'>          <span class="vi">@container</span><span class="o">[</span><span class="n">object</span><span class="o">.</span><span class="n">created_at</span><span class="o">]</span> <span class="o">||=</span> <span class="o">[]</span>
</span><span class='line'>          <span class="vi">@container</span><span class="o">[</span><span class="n">object</span><span class="o">.</span><span class="n">created_at</span><span class="o">]</span> <span class="o">&lt;&lt;</span> <span class="n">object</span><span class="o">.</span><span class="n">text</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>        <span class="c1"># Container will only keep tweets which are 5 mins up to date</span>
</span><span class='line'>        <span class="vi">@container</span><span class="o">.</span><span class="n">keep_if</span> <span class="p">{</span><span class="o">|</span><span class="n">time</span><span class="p">,</span> <span class="n">tweet</span><span class="o">|</span> <span class="vi">@mins</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">time</span><span class="p">}</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">stop</span>
</span><span class='line'>    <span class="no">Thread</span><span class="o">.</span><span class="n">kill</span><span class="p">(</span><span class="vi">@background_thread</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Massager</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:raw_tweets</span><span class="p">,</span> <span class="ss">:top_tweets</span><span class="p">,</span> <span class="ss">:container</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@container</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:container</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">top_tweets</span>
</span><span class='line'>    <span class="n">build</span>
</span><span class='line'>    <span class="n">sort</span>
</span><span class='line'>    <span class="nb">format</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">build</span>
</span><span class='line'>    <span class="vi">@raw_tweets</span> <span class="o">=</span> <span class="no">Hash</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@container</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">tweet</span><span class="o">|</span>
</span><span class='line'>      <span class="vi">@raw_tweets</span><span class="o">[</span><span class="n">tweet</span><span class="o">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">sort</span>
</span><span class='line'>    <span class="vi">@raw_tweets</span> <span class="o">=</span> <span class="vi">@raw_tweets</span><span class="o">.</span><span class="n">sort</span><span class="p">{</span><span class="o">|</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">|</span> <span class="n">a</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">&lt;=&gt;</span> <span class="n">b</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">}</span><span class="o">.</span><span class="n">last</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">format</span>
</span><span class='line'>    <span class="vi">@raw_tweets</span><span class="o">.</span><span class="n">inject</span><span class="p">({})</span> <span class="k">do</span> <span class="o">|</span><span class="n">memo</span><span class="p">,</span> <span class="n">value</span><span class="o">|</span>
</span><span class='line'>      <span class="n">memo</span><span class="o">[</span><span class="n">value</span><span class="o">[</span><span class="mi">1</span><span class="o">]]</span> <span class="o">||=</span> <span class="o">[]</span>
</span><span class='line'>      <span class="n">memo</span><span class="o">[</span><span class="n">value</span><span class="o">[</span><span class="mi">1</span><span class="o">]]</span> <span class="o">&lt;&lt;</span> <span class="n">value</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'>      <span class="n">memo</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">Manager</span>
</span><span class='line'>  <span class="kp">attr_reader</span> <span class="ss">:container</span><span class="p">,</span> <span class="ss">:streamer</span><span class="p">,</span> <span class="ss">:massager</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@container</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>    <span class="vi">@streamer</span> <span class="o">=</span> <span class="no">Streamer</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">container</span><span class="p">:</span> <span class="vi">@container</span><span class="p">,</span> <span class="ss">mins</span><span class="p">:</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:mins</span><span class="o">]</span><span class="p">,</span> <span class="ss">client</span><span class="p">:</span> <span class="n">attributes</span><span class="o">[</span><span class="ss">:client</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@massager</span> <span class="o">=</span> <span class="no">Massager</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">container</span><span class="p">:</span> <span class="vi">@container</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">client</span> <span class="o">=</span> <span class="ss">Twitter</span><span class="p">:</span><span class="ss">:Streaming</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">consumer_key</span>        <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">consumer_secret</span>     <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">access_token</span>        <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">access_token_secret</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">mins</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'><span class="n">manager</span> <span class="o">=</span> <span class="no">Manager</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">mins</span><span class="p">:</span> <span class="n">mins</span><span class="p">,</span> <span class="ss">client</span><span class="p">:</span> <span class="n">client</span><span class="p">)</span>
</span><span class='line'><span class="n">manager</span><span class="o">.</span><span class="n">streamer</span><span class="o">.</span><span class="n">stream</span>
</span><span class='line'>
</span><span class='line'><span class="n">start_time</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span>
</span><span class='line'><span class="kp">loop</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">window_start</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="o">*</span><span class="n">mins</span> <span class="p">?</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="mi">60</span><span class="o">*</span><span class="n">mins</span> <span class="p">:</span> <span class="n">start_time</span>
</span><span class='line'>  <span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;------------- Top Ten Tweets from </span><span class="si">#{</span><span class="n">window_start</span><span class="si">}</span><span class="s2"> To </span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="si">}</span><span class="s2"> ---------------&quot;</span>
</span><span class='line'>  <span class="n">pp</span> <span class="n">manager</span><span class="o">.</span><span class="n">massager</span><span class="o">.</span><span class="n">top_tweets</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/27/rotx-and-compromise/">Rotx and Compromise</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-27T20:36:18-07:00" pubdate data-updated="true">Mar 27<span>th</span>, 2014</time>
        
           | <a href="/blog/2014/03/27/rotx-and-compromise/#disqus_thread"
             data-disqus-identifier="http://haozeng.github.io/blog/2014/03/27/rotx-and-compromise/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Rotx exercise:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">rotx</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">encrypt</span><span class="o">=</span><span class="kp">true</span><span class="p">)</span>
</span><span class='line'>  <span class="n">letters</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="o">.</span><span class="n">.</span><span class="s1">&#39;z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_a</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">map!</span> <span class="k">do</span> <span class="o">|</span><span class="n">letter</span><span class="o">|</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">letter</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sr">/[a-zA-Z]/</span><span class="p">)</span>
</span><span class='line'>      <span class="c1"># Looking for index</span>
</span><span class='line'>      <span class="n">index</span> <span class="o">=</span> <span class="n">letter</span> <span class="o">==</span> <span class="n">letter</span><span class="o">.</span><span class="n">downcase</span> <span class="p">?</span> <span class="n">letters</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">letter</span><span class="p">)</span> <span class="p">:</span> <span class="n">letters</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">letter</span><span class="o">.</span><span class="n">downcase</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># Building rotated index either by moving forward or backward</span>
</span><span class='line'>      <span class="n">rotated_index</span> <span class="o">=</span> <span class="n">encrypt</span> <span class="p">?</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span><span class="o">%</span><span class="mi">26</span> <span class="p">:</span> <span class="p">(</span><span class="n">index</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">%</span><span class="mi">26</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># Building new letter based on rotated index</span>
</span><span class='line'>      <span class="n">letter</span> <span class="o">==</span> <span class="n">letter</span><span class="o">.</span><span class="n">downcase</span> <span class="p">?</span> <span class="n">letters</span><span class="o">[</span><span class="n">rotated_index</span><span class="o">]</span> <span class="p">:</span> <span class="n">letters</span><span class="o">[</span><span class="n">rotated_index</span><span class="o">].</span><span class="n">upcase</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="n">letter</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span><span class="o">.</span><span class="n">join</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">describe</span> <span class="s1">&#39;Test #rotx&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">it</span> <span class="s1">&#39;should rotate the string and encrypt as default&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">rotx</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;Hello, World&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="n">eql</span> <span class="s1">&#39;Rovvy, Gybvn&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">it</span> <span class="s1">&#39;should rotate back the string if encrypt is false&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">rotx</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;Rovvy, Gybvn&#39;</span><span class="p">,</span> <span class="kp">false</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="n">eql</span> <span class="s1">&#39;Hello, World&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">it</span> <span class="s1">&#39;should return the same results if roration number is added 26&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">rotx</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="s1">&#39;Hello, World&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="n">eql</span> <span class="s1">&#39;Rovvy, Gybvn&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>A simple compromise implementation, and this will build the foundation in removing callbacks in node.js app.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">Promise</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span> <span class="o">=</span> <span class="p">[];</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Promise</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">resolve</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;A promise should only be able to be resolved once !&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">triggerCallbacks</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Promise</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">success</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">fn</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">this</span><span class="p">.</span><span class="nx">triggerCallbacks</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Promise</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">triggerCallbacks</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">callback</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">();</span>
</span><span class='line'><span class="kd">var</span> <span class="nx">bar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="nx">foo</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>  <span class="nx">bar</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">);</span>
</span><span class='line'><span class="p">},</span> <span class="mi">500</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nx">foo</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="nx">bar</span><span class="p">.</span><span class="nx">success</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Throw errors if one promise tries to resolve twice</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="nx">foobar</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">();</span>
</span><span class='line'><span class="nx">foobar</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">foobar</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/03/23/test/">Extract Values From Javascript Nested Object</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-03-23T11:00:09-07:00" pubdate data-updated="true">Mar 23<span>rd</span>, 2014</time>
        
           | <a href="/blog/2014/03/23/test/#disqus_thread"
             data-disqus-identifier="http://haozeng.github.io/blog/2014/03/23/test/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Underscore doesn&rsquo;t support search and find nested value in a nested javascript object,
So I went ahead and built a version for that:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1"># This helper is served to relieve the efforts of building up external formatted object through</span>
</span><span class='line'><span class="c1"># nested object which we retrieve from mongoDB or http params</span>
</span><span class='line'><span class="c1"># Usage:</span>
</span><span class='line'><span class="c1">#     SampleData =</span>
</span><span class='line'><span class="c1">#       token: &#39;1234&#39;,</span>
</span><span class='line'><span class="c1">#       user:</span>
</span><span class='line'><span class="c1">#         token: &#39;4321&#39;</span>
</span><span class='line'><span class="c1">#       contact:</span>
</span><span class='line'><span class="c1">#         address:</span>
</span><span class='line'><span class="c1">#           city: &#39;Emeryville&#39;</span>
</span><span class='line'><span class="c1">#           state: &#39;CA&#39;</span>
</span><span class='line'><span class="c1">#           zip_code: &#39;51421&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># All we need to do is</span>
</span><span class='line'><span class="c1"># Helper.DataPicker(SampleData, &#39;token&#39;, &#39;user.token&#39;, &#39;city&#39;)</span>
</span><span class='line'><span class="c1"># For nested key with the duplicated names, we need to nest the top parents nodes as well.</span>
</span><span class='line'><span class="c1"># For example &#39;user.token&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">_ = </span><span class="nx">require</span> <span class="s">&#39;underscore&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">DataPicker = </span><span class="nf">(data, attributes...) -&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">result = </span><span class="p">{}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Loop through each pair of data and find the matching attributes</span>
</span><span class='line'>  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">data</span><span class="p">,</span> <span class="nf">(value, key, list) -&gt;</span>
</span><span class='line'>    <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">attributes</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">and</span> <span class="p">(</span><span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">list</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="o">or</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">value</span><span class="p">))</span>
</span><span class='line'>      <span class="nx">result</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">||=</span> <span class="nx">value</span>
</span><span class='line'>    <span class="k">else</span> <span class="k">if</span> <span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">and</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span>
</span><span class='line'>      <span class="k">for</span> <span class="nx">subKey</span><span class="p">,</span> <span class="nx">subValue</span> <span class="k">of</span> <span class="nx">value</span>
</span><span class='line'>        <span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">(</span><span class="nx">subValue</span><span class="p">,</span> <span class="nx">subKey</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># Loop through nested cases like user.token, merchant.token</span>
</span><span class='line'>  <span class="nx">_</span><span class="p">.</span><span class="nx">each</span> <span class="nx">attributes</span><span class="p">,</span> <span class="nf">(attribute) -&gt;</span>
</span><span class='line'>    <span class="k">if</span> <span class="nx">attribute</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^[a-z]+[.]/</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">keys = </span><span class="nx">attribute</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">element = </span><span class="nx">keys</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
</span><span class='line'>      <span class="nv">nestedElement = </span><span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">keys</span><span class="p">,</span> <span class="nf">(memo, num) -&gt;</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">memo</span><span class="p">)</span>
</span><span class='line'>          <span class="nv">memo = </span><span class="nx">memo</span><span class="p">[</span><span class="nx">num</span><span class="p">]</span>
</span><span class='line'>      <span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">result</span><span class="p">[</span><span class="nx">element</span><span class="p">]</span> <span class="o">=</span> <span class="nx">nestedElement</span> <span class="k">if</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isUndefined</span><span class="p">(</span><span class="nx">nestedElement</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="nx">result</span>
</span><span class='line'>
</span><span class='line'><span class="nv">module.exports = </span><span class="nx">DataPicker</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/05/trees-in-ruby/">DFS and BFS in Ruby Using Simple Tree Objects</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-05T08:54:11-08:00" pubdate data-updated="true">Jan 5<span>th</span>, 2014</time>
        
           | <a href="/blog/2014/01/05/trees-in-ruby/#disqus_thread"
             data-disqus-identifier="http://haozeng.github.io/blog/2014/01/05/trees-in-ruby/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In Ruby, there is no existing pre-built tree structures available, but it is pretty easy to define
tree objects. Here is the an exmaple which DFS and BFS are performed using ruby.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Node</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:value</span><span class="p">,</span> <span class="ss">:left</span><span class="p">,</span> <span class="ss">:right</span><span class="p">,</span> <span class="ss">:name</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">{})</span>
</span><span class='line'>    <span class="vi">@value</span> <span class="o">=</span> <span class="n">options</span><span class="o">[</span><span class="ss">:value</span><span class="o">]</span>
</span><span class='line'>    <span class="vi">@name</span> <span class="o">=</span> <span class="n">options</span><span class="o">[</span><span class="ss">:name</span><span class="o">]</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">children</span>
</span><span class='line'>    <span class="o">[</span><span class="vi">@left</span><span class="p">,</span> <span class="vi">@right</span><span class="o">].</span><span class="n">compact</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">children?</span>
</span><span class='line'>    <span class="vi">@left</span> <span class="o">&amp;&amp;</span> <span class="vi">@right</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">no_children?</span>
</span><span class='line'>    <span class="o">!</span><span class="n">children?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">root</span> <span class="o">=</span> <span class="no">Node</span><span class="o">.</span><span class="n">new</span><span class="p">({</span><span class="ss">:value</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;root&#39;</span><span class="p">})</span>
</span><span class='line'><span class="n">child_1</span> <span class="o">=</span> <span class="no">Node</span><span class="o">.</span><span class="n">new</span><span class="p">({</span><span class="ss">:value</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;child_1&#39;</span><span class="p">})</span>
</span><span class='line'><span class="n">child_2</span> <span class="o">=</span> <span class="no">Node</span><span class="o">.</span><span class="n">new</span><span class="p">({</span><span class="ss">:value</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;child_2&#39;</span><span class="p">})</span>
</span><span class='line'><span class="n">grand_child_1</span> <span class="o">=</span> <span class="no">Node</span><span class="o">.</span><span class="n">new</span><span class="p">({</span><span class="ss">:value</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;grand_child_1&#39;</span><span class="p">})</span>
</span><span class='line'><span class="n">grand_grand_child_1</span> <span class="o">=</span> <span class="no">Node</span><span class="o">.</span><span class="n">new</span><span class="p">({</span><span class="ss">:value</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;grand_grand_child_1&#39;</span><span class="p">})</span>
</span><span class='line'><span class="n">grand_child_1</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">grand_grand_child_1</span>
</span><span class='line'><span class="n">child_1</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">grand_child_1</span>
</span><span class='line'><span class="n">root</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">child_1</span>
</span><span class='line'><span class="n">root</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">child_2</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">bfs</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span class='line'>  <span class="n">queue</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class='line'>  <span class="n">queue</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="n">queue</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'>    <span class="n">n</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">shift</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="n">n</span><span class="o">.</span><span class="n">value</span>
</span><span class='line'>    <span class="n">n</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">child</span><span class="o">|</span>
</span><span class='line'>      <span class="n">queue</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">bfs</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="s1">&#39;~~~~~~~~~~~~~~~~~~~~~~~~~~~&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">dfs</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span>
</span><span class='line'>  <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">child</span><span class="o">|</span>
</span><span class='line'>    <span class="n">dfs</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">dfs</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/30/multiple-variables-same-value-in-ruby/">Create Multiple Varariables With Differentreferences in Ruby</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-30T19:25:50-08:00" pubdate data-updated="true">Jan 30<span>th</span>, 2013</time>
        
           | <a href="/blog/2013/01/30/multiple-variables-same-value-in-ruby/#disqus_thread"
             data-disqus-identifier="http://haozeng.github.io/blog/2013/01/30/multiple-variables-same-value-in-ruby/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I had a bug in ruby which I do not quite understand, and it turned out to be reference issue in ruby.</p>

<p>First, I tried something like this and intended to create 4 variables for the same values, but different objects</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="p">,</span><span class="n">d</span> <span class="o">=</span> <span class="o">[</span><span class="no">Object</span><span class="o">.</span><span class="n">new</span><span class="o">]</span> <span class="o">*</span> <span class="mi">4</span>
</span></code></pre></td></tr></table></div></figure>


<p>This turns out to be a, b, c, d refers to the same object</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">a</span><span class="o">.</span><span class="n">object_id</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">object_id</span>
</span><span class='line'><span class="c1">#=&gt; true</span>
</span></code></pre></td></tr></table></div></figure>


<p>So the correct way should be:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="no">Object</span><span class="o">.</span><span class="n">new</span><span class="p">,</span> <span class="no">Object</span><span class="o">.</span><span class="n">new</span><span class="p">,</span> <span class="no">Object</span><span class="o">.</span><span class="n">new</span><span class="p">,</span> <span class="no">Object</span><span class="o">.</span><span class="n">new</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <div class='bio'>
    <h1 class='name'> I am Hao Zeng</h1>
    <img src="http://www.gravatar.com/avatar/49ae3cfa787372d49bc0c03cff0cf95e" />
    <p> A web developer </p>
    <p> Lives in San Francisco <p>
    <p> Writing codes for <a href="https://www.marqeta.com"> Marqeta </a> </p>
    <p> <a href="/about-me"> More </a> </p>
  </div>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/05/08/twitter-streaming-retweets/">Twitter Streaming Retweets</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/27/rotx-and-compromise/">Rotx and Compromise</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/03/23/test/">Extract Values From Javascript Nested Object</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/05/trees-in-ruby/">DFS and BFS in Ruby Using Simple Tree Objects</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/30/multiple-variables-same-value-in-ruby/">Create Multiple Varariables With Differentreferences in Ruby</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/haozeng">@haozeng</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'haozeng',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Hao Zeng -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'hzeng';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
